#### DNS

​	域名系统（Domain Name System）是因特网使用的命名系统，作用是通过域名查询到具体ip。ip不利于人类记忆，所以出现了域名来与ip对应。一个域名对应一个ip，一个ip可以有多个域名。DNS是基于UDP进行查询的。

##### 域名服务器

- 本地域名服务器：主机发出DNS查询时，会直接发送查询请求给**本地域名服务器**。

- 根域名服务器：最高层次的域名服务器。根域名服务器一般不直接将查询的域名转换成ip地址，而是告诉**本地域名服务器**下一步应该找哪个**顶级域名服务器**。

- 顶级域名服务器：负责管理该顶级域名（如com、cn）下注册的所有耳机服务器。如果不能给出查询的结果，该服务器会告诉DNS客户，下一个查找的**权限域名服务器**。

- 权限域名服务器：负责一个区的服务器，该服务器只能通过上一级服务器进行授权后才能访问。一个**权限域名服务器**不能给出查询结果时，会通知下一个查找的**权限域名服务器**。

  **PS：服务器会在一定时间内保存一定数量的查询记录，后续查询到有同样的域名信息会直接从缓存中调出。以加速查询效率。**

##### 迭代查询和递归查询

​	前者是DNS请求全部由自身发起，后者是委托后续服务器请求，得到最终结果后返回给发起的服务器。

**DNS客户端和本地域名服务器之间是递归查询，本地域名服务器与其他域名服务器之间是迭代查询。（下图第一种情况）。**当本地域名服务器无法解析时，会请求其他域名服务器。此时，本地域名服务器将代替DNS客户端进行的（即以本地域名服务器为中心），DNS客户端只需等待本地域名服务器返回最终的查询结果。

##### DNS查询过程

1. **客户端**向本机配置的**本地域名服务器**发出DNS域名查询请求。
2. **本地域名服务器**收到请求，查询本地缓存，如果有该域名的记录项，将查询结果返回给**客户端**；如果缓存中没有该记录，则**本地域名服务器**再以DNS客户端的角色发送请求给**根域名服务器**。
3. **根域名服务器**收到DNS请求后，把所查询到的**顶级域名服务器**自动地址返回给**本地域名服务器**。
4. **本地域名服务器**根据**根域名服务器**所返回的（顶级域名服务器）地址，向**本地域名服务器**发送同样的DNS域名查询请求。
5. 对应的**顶级域名服务器**在收到DNS查询请求后，查询自身缓存，如有记录项则直接返回给**本地域名服务器**，然后本地域名服务器返回给客户端；否则**本地域名服务器**返回所请求的DNS域名的二级域名所对应的**二级域名服务器**地址。
6. **本地域名服务器**以同样的方式向**三级、四级域名服务器**查询，直到对应域名所在区域的**权威域名服务器**返回结果。**本地域名服务器**再将结果返回给DNS客户，同时**本地域名服务器**会缓存本次查询的记录项。

![image-20210324135912184](%E4%BB%8E%E8%BE%93%E5%85%A5url%E5%88%B0%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93.assets/image-20210324135912184.png)

#### 从输入url到页面渲染

1. 地址解析。

   1. 操作系统首先在本地缓存中查询ip
   2. 没有结果，去系统配置的DNS服务器中查询（本地域名服务器）
   3. 还是没有，查询根域名服务器，查询一级域名的服务器、依次查询二级域名、三级以此类推，直至查到权威域名服务器。（DNS查询过程）

2. TCP握手

   1. TCP握手（TCP握手过程和特性）
   2. TCP握手后，进行TLS握手，之后开始正式传输数据（TLS握手情况和两种加密）

3. 数据传输

   服务器：数据进入服务端之前，可能会经过负责负载均衡的服务器，其作用是将请求分发到多台服务器上。

   浏览器：浏览器通过请求获取资源。

4. 浏览器解析

   1. 200继续解析，400或500报错，300进行重定向（有重定向计数器，会限制重定向次数）
   2. gzip格式会进行解压，并通过文件编码格式继续解码文件

5. 浏览器渲染

   1. HTML→DOM树	CSS→CSSOM树
   2. script标签执行，阻塞渲染流程直到JS执行完毕。遇到文件下载会下载文件（HTTP/2协议会极大提高多图的下载速度）    async会并行下载并执行JS，defer会先下载文件，然后等待HTML解析完成后顺序执行。
   3. CSSOM树和DOM树构建完成后会开始生成Render树。Render树的生成，浏览器开始调用GPU绘制，合成图层，将内容显示在屏幕上。

   

https://github.com/alex/what-happens-when

